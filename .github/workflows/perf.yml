name: Perf

on:
  pull_request:
    branches: ["main"]

permissions:
  contents: read
  pull-requests: write

jobs:
  iai-callgrind:
    name: iai-callgrind PR Bench
    uses: terjekv/github-action-iai-callgrind/.github/workflows/iai-callgrind-pr-bench.yml@v1
    with:
      benchmarks_json: >-
        [
          "evaluate_iai_baseline",
          "evaluate_iai_groups",
          "evaluate_iai_labels",
          "evaluate_iai_namespaced",
          "bench_iai_loader",
          "bench_iai_policy_match",
          "bench_iai_query",
          "bench_iai_entity_uid",
          "bench_iai_attr_value",
          "bench_iai_metrics",
          "bench_iai_timers"
        ]
      feature_sets_json: >-
        [
          {"name":"no-obs","features":"bench-internal"},
          {"name":"obs","features":"bench-internal,observability"}
        ]
      regression_threshold_pct: 8
      fail_on_regression: true
